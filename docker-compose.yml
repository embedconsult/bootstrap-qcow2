services:
  codex:
    build:
      context: .
      dockerfile: Dockerfile.codex
    container_name: bootstrap-qcow2-codex
    security_opt:
      - seccomp=unconfined
      - apparmor=unconfined
    cap_add:
      - SYS_ADMIN
    sysctls:
      kernel.unprivileged_userns_clone: "1"
      kernel.apparmor_restrict_unprivileged_userns: "0"
    tmpfs:
      - /run
      - /run/lock
    working_dir: /work
    volumes:
      - ./codex/work:/work
    environment:
      OPENAI_API_KEY: ${OPENAI_API_KEY}
    tty: true
    stdin_open: true
    command: bash

  codex-privileged:
    build:
      context: .
      dockerfile: Dockerfile.codex
    container_name: bootstrap-qcow2-codex-privileged
    privileged: true
    userns_mode: host
    security_opt:
      - apparmor=unconfined
    working_dir: /work
    volumes:
      - ./codex/work:/work
    environment:
      OPENAI_API_KEY: ${OPENAI_API_KEY}
    tty: true
    stdin_open: true
    command: bash

